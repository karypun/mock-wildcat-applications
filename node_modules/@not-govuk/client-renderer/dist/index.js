"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hydrateOrRender = void 0;
const react_1 = require("react");
const react_dom_1 = require("react-dom");
const app_composer_1 = require("@not-govuk/app-composer");
exports.hydrateOrRender = ({ AppWrap, ErrorPage, LoadingPage, PageWrap, pageLoader }) => {
    ;
    const routerProps = {};
    const windowWithProps = window;
    const app = react_1.createElement(app_composer_1.compose({
        AppWrap,
        ErrorPage,
        LoadingPage,
        PageWrap,
        data: windowWithProps.hydration.data.cache,
        graphQL: {
            endpoint: '/graphql'
        },
        pageLoader,
        routerProps,
        user: windowWithProps.hydration.data.user
    }), windowWithProps.hydration.data.props);
    const root = document.getElementById(windowWithProps.hydration.id);
    try {
        react_dom_1.hydrate(app, root);
        console.info('Hydration complete.');
    }
    catch (e) {
        console.log(e);
        console.warn('Hydration failed. Attempting to re-render...');
        try {
            react_dom_1.render(app, root);
            console.info('Render complete.');
        }
        catch (e) {
            console.log(e);
            console.warn('Render failed. Falling back to SSR...');
        }
    }
    const jsEnabledClass = 'js-enabled';
    document.body.className = (document.body.className
        ? `${document.body.className} ${jsEnabledClass}`
        : jsEnabledClass);
};
exports.default = exports.hydrateOrRender;
